<!-- This template is to initiate a new request. -->

{% extends "base.html" %}

{% block title %}Public records{% endblock title%}

{% block container %}
  <div class="row-fluid">

    <div class="span8 offset1">
      <div class="row-fluid">
        <div class="span8">
          <form name="input" class="form-horizontal" id="submitRequest" method="post" action="/new" autocomplete="on"novalidate="novalidate">
            <fieldset>

              <h3>Create a new request</h3>

              <p class="lead">What are you trying to find?</p>

              <div class="control-group">
                <!-- <label class="control-label" for="requestTextarea">What are you trying to find?</label> -->
                <div >
                  <textarea id="requestTextarea" autofocus  name="request_text" rows="3" class="input-block-level" placeholder="Describe your request. Be as specific as possible." ></textarea>
                  <!-- <span class="request_field_explanation"><p>{{"Enter records request" | explain_action("What")}}</p><p><em>{{"Enter records request" | explain_action("Who")}}</em> {{"Enter records request" | explain_action("Action")}}</p></span> -->
                </div>
              </div>

              <p class="lead">Select a department</p>
              <div class="control-group">
                <div>
                  <input id="inputDepartment" class="input-block-level" type="text" name="request_department" placeholder="Who should it go to?" data-provide="typeahead" autocomplete="off" />
                  <!-- <span class="request_field_explanation"><em>{{"Enter department or document type" | explain_action("Who")}}</em> {{"Enter department or document type" | explain_action("Action")}} </span> -->
                </div>
              </div>
               
              <p class="lead">Contact information</p>  
              <div class="control-group">
                <label for="inputEmail">Your email</label>
                <div>
                  <input class="input-block-level" name="request_email" type="email" id="inputEmail" placeholder="yourname@email.com" />
                  <!-- <span class="request_field_explanation"><em>{{"Enter email address" | explain_action("Who")}}</em> {{"Enter email address" | explain_action("Action")}} </span> -->
                </div>
              </div>
              
              <div class="control-group">
                <label for="inputName">Your name</label>
                <div >
                  <input class="input-block-level" name="request_alias" type="text" id="inputName" placeholder="Your Name" />
                  <!-- <span class="request_field_explanation"><em>{{"Enter name" | explain_action("Who")}}</em>{{"Enter name" | explain_action("Action")}}</span> -->
                </div>
              </div>
            
              <div class="control-group">
                <label for="inputPhone">Your phone number</label>
                <div>
                  <input class="input-block-level" name="request_phone" type="tel" id="inputPhone" placeholder="(510) 555-1234" maxlength="14" />
                  <!-- <span class="request_field_explanation"><em>{{"Enter phone number" | explain_action("Who")}}</em>  {{"Enter phone number" | explain_action("Action")}}</span> -->
                </div>
              </div>

              <div id="requestButton" class="control-group">
                <div>
                  <button type="submit" class="btn input-block-level btn-primary">Submit my request</button>
                </div>
              </div>
              
            </fieldset>
          </form>
        </div>
      </div>
    </div>

    <div class="span3">
      {% block sidebar %}
        <div class="well r_sidebar r_sidebar-fixed hidden-phone hidden-tablet">
          <h4>Tips</h4>
            <ul>
              <li>Describe in detail the type of information you want.</li>
              <li>Limit your request by a date range.</li>
              <li>Provide the name of the record or take a guess.</li>
              <li>Don’t reveal personal information, like your social security number, driver’s license number, or home address.</li>
            </ul>
          <h4>Example</h4>
            <p><em>I need a copy of the all of Mayor Jean Quan’s emails sent between July 30, 2013-August 8, 2013.</p> <p>The emails should contain the words “Art+Soul festival” or  “Art + Soul Oakland.”</em></p>
        </div>
      {% endblock sidebar %}
    </div>

  </div>
{% endblock container %}



{% block custom_script_links %}
  <link rel=stylesheet type=text/css href="{{ url_for('static', filename='css/sidebar.css') }}">
  <script>
    /* validates add a request form */
    $(document).ready(function(){
     
      $("#submitRequest").validate({
        // ignore: ".ignore",
        rules: {
          request_text: {
            required: true,
            minlength: 2
               }
           },
        highlight: function(element) {
            // $('#inputEmail').addClass('ignore');
            // $('#requestButton').html(
            //   "<div id='no_email' class='alert alert-block alert-error fade in'>"+
            //     "<h4 class='alert-heading'>Oops, you forgot to provide an email address.</h4>"+
            //       "<p>Your email is how we contact you.  If you choose to leave it blank, you will not receive updates about your request.  Your request may take longer or be dismissed if it is missing important information. You can still enter your e-mail address at this time, and continue with submission.</p>"+
            //       "<button id='submit_anyway' class='btn btn-danger' type='submit'>Got it, submit my request!</button>"+
            //     "</div>"
            //   );
          $(element).closest('.control-group').removeClass('success').addClass('error');
          },
        success: function(element) {
          // $('#requestButton').html(
          //   "<div id='requestButton' class='control-group'>"+
          //     "<div class='controls'>"+
          //       "<button type='submit' class='btn btn-large btn-primary'>Request</button>"+
          //     "</div>"+
          //   "</div>"
          //   );
          element
          .text('OK!').addClass('valid')
          .closest('.control-group').removeClass('error').addClass('success');
          }  
      });

    });
  </script>
<script>

$(document).ready(function() {
  var map = {};
  var departments = [];
  var doc_types = [];
  $.getJSON("{{ url_for('static', filename='json/doctypes.json') }}", function(data) {
        $.each(data, function (i, line) {
          var department = line['DEPARTMENT'];
          var doc_type = line['DOC_TYPE'];
          if($.inArray(department, departments) == -1) {
            departments.push(department);
           }
            map[doc_type + " - " + department] = department;
            doc_types.push(doc_type + " - " + department);
         });
      });
  /* typeahead for email in reroute form */
  $('#inputDepartment').typeahead({
        source: doc_types
        , updater: function (item) {
          department = map[item];
          return department;
        }
        ,matcher: function(item) {
          if (item.toLowerCase().indexOf(this.query.trim().toLowerCase()) != -1){
          return true;
         }
        }
      , items: 8
      , menu: '<ul class="typeahead dropdown-menu"></ul>'
      , item: '<li><a href="#"></a></li>'
      , minLength: 1
      })
  });
</script>
{% endblock custom_script_links %}
