<!-- This template is to initiate a new request. -->

{% extends "base.html" %}

{% block title %}Public records{% endblock title%}

{% block container %}
  <div class="row-fluid">

    <div class="span8 offset1">
      <div class="row-fluid">
        <div class="span8">
          <form name="input" class="form-horizontal" id="submitRequest" method="post" action="/new" autocomplete="on"novalidate="novalidate">
            <fieldset>

              <h3>Create a new request</h3>

              <p class="lead">What are you trying to find?</p>
              <p>Use this site to request copies of specific documents, photos, emails, texts, audio recordings, electronic information and data in the City’s databases. If you need general information on City services, try <a href="http://answers.oaklandnet.com">Oakland Answers</a>.</p>

              <div class="control-group">
                <label for="requestTextarea"><strong><i class="icon-exclamation-sign"></i> Everything in this request box will be displayed publicly.</strong></label>
                <div >
                  <!-- <a data-placement="right" data-toggle="popover" href="#" id="requestPopover" class="hidden-phone hidden-tablet"> -->
                  <textarea id="requestTextarea" name="request_text" rows="3" class="input-block-level" placeholder="Describe your request. Be as specific as possible."></textarea>
                 <!--  </a> -->
                  {% include '_help_text_request.html' %}
                </div>
                <div>
                  not_city_records text goes here
                </div>
              </div>


              <p class="lead">Select a department</p>
              <div class="control-group">
                <div>
                  <input id="inputDepartment" class="input-block-level" type="text" name="request_department" placeholder="Who should it go to?" data-provide="typeahead" autocomplete="off" />
                  {% include '_help_text_department.html' %}
                </div>
              </div>
               
              <p class="lead">Contact information</p>  
              <div class="control-group">
                <label for="inputEmail">Your email</label>
                <div>
                  <input class="input-block-level" name="request_email" type="email" id="inputEmail" placeholder="yourname@email.com" />
                  {% include '_help_text_email.html' %}
                </div>
              </div>
              
              <div class="control-group">
                <label for="inputName">Your name</label>
                <div >
                  <input class="input-block-level" name="request_alias" type="text" id="inputName" placeholder="Your Name" />
                  {% include '_help_text_name.html' %}
                </div>
              </div>
            
              <div class="control-group">
                <label for="inputPhone">Your phone number</label>
                <div>
                  <input class="input-block-level" name="request_phone" type="tel" id="inputPhone" placeholder="(510) 555-1234" maxlength="14" />
                  {% include '_help_text_phone.html' %}
                </div>
              </div>

              <div id="requestButton" class="control-group">
                <div>
                  <button type="submit" class="btn input-block-level btn-primary">Submit my request</button>
                </div>
              </div>
              
            </fieldset>
          </form>
        </div>
      </div>
    </div>

    <div class="span3">
      {% block sidebar %}
        <div class="well r_sidebar r_sidebar-fixed hidden-phone hidden-tablet">
          <h4>Tips</h4>
            <ul>
              <li>Don't reveal personal information, like your social security number or home address.</li>
              <li>Limit your request by a date range.</li>
              <li>Provide the name of the record or take a guess.</li>
              <li>If you don't know the name of the record, describe the information you believe is contained in it.</li>
            </ul>
          <h4>Example</h4>
            <blockquote><p>I need a copy of the all of Mayor Jean Quan’s emails sent to City Administrator Santana between July 30, 2013-August 8, 2013.</p><p>The emails should contain the words “Art+Soul festival” or  “Art + Soul Oakland.”</p></blockquote>
        </div>
      {% endblock sidebar %}
    </div>

  </div>
{% endblock container %}



{% block custom_script_links %}
  <link rel=stylesheet type=text/css href="{{ url_for('static', filename='css/sidebar.css') }}">
  <script>
    /* validates add a request form */
    $(document).ready(function(){
     
      $("#submitRequest").validate({
        // ignore: ".ignore",
        rules: {
          request_text: {
            required: true,
            minlength: 2
               }
           },
        highlight: function(element) {
            // $('#inputEmail').addClass('ignore');
            // $('#requestButton').html(
            //   "<div id='no_email' class='alert alert-block alert-error fade in'>"+
            //     "<h4 class='alert-heading'>Oops, you forgot to provide an email address.</h4>"+
            //       "<p>Your email is how we contact you.  If you choose to leave it blank, you will not receive updates about your request.  Your request may take longer or be dismissed if it is missing important information. You can still enter your e-mail address at this time, and continue with submission.</p>"+
            //       "<button id='submit_anyway' class='btn btn-danger' type='submit'>Got it, submit my request!</button>"+
            //     "</div>"
            //   );
          $(element).closest('.control-group').removeClass('success').addClass('error');
          },
        success: function(element) {
          // $('#requestButton').html(
          //   "<div id='requestButton' class='control-group'>"+
          //     "<div class='controls'>"+
          //       "<button type='submit' class='btn btn-large btn-primary'>Request</button>"+
          //     "</div>"+
          //   "</div>"
          //   );
          element
          .text('OK!').addClass('valid')
          .closest('.control-group').removeClass('error').addClass('success');
          }  
      });

    });
  </script>
<script>

$(document).ready(function() {
  var map = {};
  var departments = [];
  var doc_types = [];
  $.getJSON("{{ url_for('static', filename='json/doctypes.json') }}", function(data) {
        $.each(data, function (i, line) {
          var department = line['DEPARTMENT'];
          var doc_type = line['DOC_TYPE'];
          if($.inArray(department, departments) == -1) {
            departments.push(department);
           }
            map[doc_type + " - " + department] = department;
            doc_types.push(doc_type + " - " + department);
         });
      });
  /* typeahead for email in reroute form */
  $('#inputDepartment').typeahead({
        source: doc_types
        , updater: function (item) {
          department = map[item];
          return department;
        }
        ,matcher: function(item) {
          if (item.toLowerCase().indexOf(this.query.trim().toLowerCase()) != -1){
          return true;
         }
        }
      , items: 8
      , menu: '<ul class="typeahead dropdown-menu"></ul>'
      , item: '<li><a href="#"></a></li>'
      , minLength: 1
      })
  });
</script>
{% endblock custom_script_links %}
