{% extends "case.html" %}
{% block title %}Request {{ req.id }}{% endblock %}
{% block custom_css_links %}
    <!-- used for the extension and close request multi-select boxes in city view -->
    <link rel=stylesheet type=text/css href="{{ url_for('static', filename='css/manage_request_city_less_js.css') }}">
    <link rel=stylesheet type=text/css href="{{ url_for('static', filename='css/sidebar.css') }}">
    <link rel=stylesheet type=text/css href="{{ url_for('static', filename='css/bottom_sidebar.css') }}">
    <link rel=stylesheet type=text/css href="{{ url_for('static', filename='css/case.css') }}">
    <link rel=stylesheet type=text/css href="{{ url_for('static', filename='css/plugins/bootstrap-select.css') }}">
    <link rel=stylesheet type=text/css href="{{ url_for('static', filename='css/plugins/bootstrap-fileupload.css') }}">
    <link rel=stylesheet type=text/css href="{{ url_for('static', filename='css/_response_widget.css') }}">
{% endblock custom_css_links %}

{% set alias = "Not provided" %}
{% set phone = "Not provided" %}
{% set requester = req.requester() %}
{% if requester %}
{% set user = requester.user %}
{% set email = user.email %}
{% set alias = user.alias %}
{% set phone = user.phone %}
{% set address1 = user.address1 %}
{% set address2 = user.address2 %}
{% set city = user.city %}
{% set state = user.state %}
{% set zipcode = user.zipcode %}
{% endif %}

{% block requester_info %}
{% include '_requester_info.html' %}
{% endblock requester_info %}

{% block proxyrequester_info %}
  {{ super() }}
{% endblock proxyrequester_info %}

{% block clarify_request %}
    <!-- ask a question -->
    <form name="ask_question" id="question" class="form-inline" style="margin: 10px 0px 15px 0px;" method="post" action="/add_a_qa" autocomplete="on">
      <input type="hidden" name="request_id" value="{{ req.id }}"/>
      <fieldset>
      {% if email %}
        <label>Ask a question <span rel="tooltip" data-toggle="tooltip" data-placement="right" title="" data-original-title="{{"Ask a question" | explain_action }}"><small><i class="icon-info-sign"></i></small></span></label>
          <textarea id="questionTextarea"  name="question_text" class="input-xlarge" placeholder="Ask the requester a question" required/></textarea>
        <button id="askQuestion" class="btn btn-primary" data-toggle="modal" data-target="#confirm-submit" type="submit">Ask</button>
       {% endif %}
      </fieldset>
    </form>

	<div class="modal fade" id="confirm-submit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					Confirmation
				</div>
				<div class="modal-body">
					<div id="modalquestionDiv">Are you sure you want to make the following question public and send an email to the requester?</div>
					<table id="modalQuestionTable" class="table">
						<tr>
							<th>Question</th>
							<td id="question_text"></td>
                                                        <input type="hidden" id="form_id" value=""/>
						</tr>
					</table>
                                        <table id="modalAdditionalInfoTable" class="table">
                                                <tr>
                                                        <th>Additional Information</th>
                                                        <td><textarea id="additional_note"  name="additional_note" class="input-xlarge" placeholder="Additional Information" /></textarea></td>
                                                </tr>
                                        </table>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
					<a href="#" id="submit" class="btn btn-success success">Submit</a>
				</div>
			</div>
		</div>
	</div>
{% endblock clarify_request %}

{% block response_actions_lessjs %}
  <h3 style="margin-top:40px;">Response actions</h3>

  <form class="form-horizontal">
    <fieldset>

    <!-- Form Name -->
    <!-- Multiple Radios (inline) -->

    <div clas="rw-container">

        <div class="rw-btn-wrap">Add record</div>
        <div class="rw-btn-wrap">Add note</div>
        <div class="rw-btn-wrap">Generate PDF</div>
        <div class="rw-btn-wrap">Close this request</div>
    </div>
    </fieldset>
    </form>

  <!-- upload a record -->

  <form name="input_doc" style="margin-top: 2em;" class="form-horizontal" id="submitRecord" method="post" action="/add_a_record" autocomplete="on" enctype="multipart/form-data">
    <input type="hidden" name="request_id" value="{{ req.id }}"/>
    <fieldset>
      <legend>Add a record</legend>
      <div class="row-fluid">
        <!-- name of record -->
        <div class="control-group">
          <label class="control-label" for="recordSummary">Name of record</label>
          <div class="controls">
            <textarea class="input-xxlarge" name="record_description" type="text" id="recordSummary" placeholder="Add a short explanation of the record" required /></textarea>
          </div>
        </div>
        <!-- upload a record -->
        <div class="control-group">
          <label class="control-label">Upload a record <span id="recordTooltip" rel="tooltip" data-toggle="tooltip" data-placement="right" title="" data-original-title="{{"Upload a document" | explain_action}}" ><small><i class="icon-info-sign"></i></small></span></label>
          <div class="row-fluid">
            <div class="controls">
              <div class="fileinput fileinput-new" data-provides="fileinput">
                <span class="btn btn-default btn-file">
                  <span class="fileinput-new">Select file</span>
                  <span class="fileinput-exists">Change</span>
                  <input type="file" name="record">
                </span>
                <span class="fileinput-filename"></span>
                <a href="#" class="close fileinput-exists" data-dismiss="fileinput" style="float: none">&times;</a>
              </div>
            </div>
          </div>
        </div>
        <!-- link to a record -->
        <div class="control-group">
          <label class="control-label">Or provide a link to a record <span rel="tooltip" data-toggle="tooltip" data-placement="right" title="" data-original-title="{{"Add a link" | explain_action}}"><small><i class="icon-info-sign"></i></small></span></label>
          <div class="row-fluid">
            <div class="controls">
              <input type="text" name="link_url" id="inputUrl" class="input-xxlarge"/>
              <!-- need to clean this up with jquery: needs to switch from being disabled when no file exists to being enabled when a file exists -->
            </div>
          </div>
        </div>
        <!-- offline record -->
        <div class="control-group button-margin">
          <label class="control-label">Or indicate how the record can be accessed offline <span id="offlinedocTooltip" rel="tooltip" data-toggle="tooltip" data-placement="right" title="" data-original-title="{{"Describe hard copies" | explain_action}}"><small><i class="icon-info-sign"></i></small></span></label>
          <div class="row-fluid">
            <div class="controls">
              <textarea class="input-xxlarge" id="offlineDoc_textarea" name="record_access" placeholder="How can the requester get this record?  Ex. 'Sent via mail on a CD', 'Print out awaiting requester at City Clerk desk'" ></textarea>
            </div>
          </div>
        </div>
        <!-- submission -->
        <div class="control-group">
          <div class="controls">
            <button type="submit" class="btn btn-primary" data-toggle="modal" data-target="#confirm-submit" id="addRecordButton">Add record</button>
          </div>
        </div>

      </div>
    </fieldset>
  </form>

  <!-- Add a note form -->
  <form name="note" class="form-horizontal" id="note" method="post" action="/add_a_note">
    <input type="hidden" name="request_id" value="{{ req.id }}"/>
    <fieldset>
      <legend>Add a note</legend>
      <div class="row-fluid">
        <div class="control-group">
          <label class="control-label">Note <span rel="tooltip" data-toggle="tooltip" data-placement="right" title="" data-original-title="{{"Add a note"| explain_action }}"><small><i class="icon-info-sign"></i></small></span></label>
          <div class="controls">
            <textarea type="text" class="input-xxlarge" id="noteTextarea" name="note_text"  placeholder="Notes visible to staff only."required/></textarea>
          </div>
        </div>
        <div class="control-group">
          <div class="controls">
            <button type="submit" class="btn btn-primary" data-toggle="modal" data-target="#confirm-submit" id="addNoteButton">Add note</button>
          </div>
		<input type="hidden" name="note_privacy" value="2"/>
        </div>
      </div>
    </fieldset>
  </form>
  </form>

  <!-- Generate PDF -->
  <form name="note" class="form-horizontal" id="note_pdf" method="post" action="/add_a_pdf">
    <input type="hidden" name="request_id" value="{{ req.id }}"/>
    <fieldset>
      <legend>Standard Responses (PDF)</legend>
      <div class="row-fluid">
        <div class="control-group">
          <label class="control-label">Template <span rel="tooltip" data-toggle="tooltip" data-placement="right" title="" data-original-title="{{"Generate PDF"}}"><small><i class="icon-info-sign"></i></small></span></label>
          <div class="controls">
            <select id="response_template" name="response_template" required data-selected-text-format="count" size="9">
              <option value="template_02">Message Sent</option>
              <option value="template_03">Request Status</option>
              <option value="template_04">Request Completed</option>
              <option value="template_05">Request Status - Fulfilled in Part</option>
              <option value="template_06">Request Denied</option>
              <option value="template_07">Request Closed</option>
              <option value="template_08">Request Payment Information</option>
              <option value="template_09">Request Closed - No Response</option>
              <option value="template_10">Time Extension Requested</option>
            </select>
          </div>
        </div>
        <div class="control-group">
          <div class="controls">
            <button type="submit" class="btn btn-primary">Generate PDF</button>
          </div>
        </div>
      </div>
    </fieldset>
  </form>

<!-- REMOVE THE FOLLOWING SECTION IF YOU DO NOT USE EXTENSIONS IN YOUR AGENCY. -->
  <!-- Extension.-->
  {% if req.extended %}
  {% else %}
  <form name="extend_request" class="form-horizontal" id="extension" method="post" action="/add_a_extension">
    <input type="hidden" name="request_id" value="{{ req.id }}"/>
	<input type="hidden" name="extend_reason" value="{{"Extension - Large Amount" | explain_action("What")}}"/>
    <fieldset>
      <legend>Extend request</legend>
      <div class="row-fluid">
        <div class="control-group">
          <label class="control-label">Length <span rel="tooltip" data-toggle="tooltip" data-placement="right" title="" data-original-title="{{"Request an extension"| explain_action }}"><small><i class="icon-info-sign"></i></small></span></label>
          <div class="controls">
            <select id="days_after" name="days_after">
              <option value="0">None selected</option>
              <option value="15">15 days</option>
              <option value="30">30 days</option>
              <option value="60">60 days</option>
              <option value="90">90 days</option>
              <option value="-1">Custom Due Date</option>
            </select>
          </div>
        </div>
        <div class="control-group" style="display:none;" id="custom_due_date">
          <label class="control-label">Custom Due Date<span rel="tooltip" data-toggle="tooltip" data-placement="right" title="" data-original-title="{{"Request an extension"| explain_action }}"><small><i class="icon-info-sign"></i></small></span></label>
            <div class="controls">
              <input type="date" id="due_date"
                         name="due_date"
                         value="{{ min_due_date }}"
                          >
            </div>
        </div>
        <div class="control-group">
          <div class="controls">
            <button id="extendButton" data-toggle="modal" data-target="#confirm-submit" type="submit" class="btn btn-primary">Extend this request</button>

          </div>
        </div>
      </div>
    </fieldset>
  </form>
  {% endif %}
<!-- REMOVE THE ABOVE SECTION IF YOU DO NOT USE EXTENSIONS IN YOUR AGENCY. -->

  <!-- Close request -->
  <form name="close" class="form-horizontal" id="closeRequest" method="post" action="/close">
    <input type="hidden" name="request_id" value="{{ req.id }}"/>
    <fieldset>
      <legend>Close request</legend>
      <div class="row-fluid">
        <div class="control-group">
          <label class="control-label">Reason <span rel="tooltip" data-toggle="tooltip" data-placement="right" title="" data-original-title="{{"Close a request"| explain_action }}"><small><i class="icon-info-sign"></i></small></span></label>
          <div class="controls">
            <select id="close_reasons" name="close_reasons" multiple="multiple" size="5">
              <option value="{{"Fulfilled" | explain_action("What")}}">Fulfilled</option>
              <option value="{{"Fulfilled - Private Documents Not Uploaded" | explain_action("What")}}">Fulfilled - Private Documents Not Uploaded</option>
              <option value="{{"Fulfilled - Information Redacted" | explain_action("What")}}">Fulfilled - Information Redacted</option>
              <option value="{{"Fulfilled - Identity of Citizens Making Complaints Removed" | explain_action("What")}}">Fulfilled - Identity of Citizens Making Complaints Removed</option>
              <option value="{{"Not a public records request" | explain_action("What")}}">Not a public records request</option>
              <option value="{{"Record Does Not Exist" | explain_action("What")}}">Do not have this record</option>
              <option value="{{"Can Not Release - Personal Records" | explain_action("What")}}">Can Not Release - Personal Records</option>
              <option value="{{"Can Not Release - Ongoing Litigation" | explain_action("What")}}">Can Not Release - Ongoing Litigation</option>
              <option value="{{"Can Not Release - Investigative Records" | explain_action("What")}}">Can Not Release - Investigative Records</option>
              <option value="{{"Can Not Release - Attorney-Client Privilege" | explain_action("What")}}">Can Not Release - Attorney-Client Privilege</option>
              <option value="{{"Unable to contact the requester" | explain_action("What")}}">Unable to contact the requester</option>
              <option value="{{"Contact Another Government Agency" | explain_action("What")}}">Contact Another Government Agency</option>
              <option value="{{"Requester Not Interested" | explain_action("What")}}">Requester Not Interested</option>
             <option value="{{"Initial request redirected" | explain_action("What")}}">Initial request redirected</option>
              <option value="{{"Please visit NYC.gov" | explain_action("What")}}">Please visit NYC.gov</option>
              <option value="{{"Please visit nycopendata" | explain_action("What")}}">Please visit nycopendata</option>
              <option value="{{"Please visit NYC Government Publications Portal" | explain_action("What")}}">Please visit NYC Government Publications Portal</option>
            </select>
          </div>
        </div>
        <div class="control-group">
          <div class="controls">
            <button id="closeButton" data-toggle="modal" data-target="#confirm-submit" type="submit" class="btn btn-inverse">Close this request</button>
          </div>
        </div>
      </div>
    </fieldset>
  </form>
{% endblock response_actions_lessjs %}

{% block sidebar %}

  {% block status %}
    {% set status = req.solid_status() %}
    {% include '_manage_requests_status.html' %}
  {% endblock status %}

  <div class="b_sidebar">
    <div class="row-fluid participantRow">

        <div><h4 class="participantRow-title" style="color: #333333;">Point of Contact </h4>
        </div>

    </div>
    <div class="row-fluid participantRow-poc">
        {% include '_contact_popover.html' %}
    </div>

    <form id="rerouteForm" class="form-inline" method ="post" action="/update_a_owner">
      <fieldset>
        <!-- <label>Change point of contact</label> -->
          <input type="hidden" name="request_id" value="{{ req.id }}"/>
          <!--input id="rerouteEmail" class="input-block-level" type="email" name="owner_email" placeholder="name@email.com" data-provide="typeahead" autocomplete="off" required /-->
          </select>
          <select class="span10" id="rerouteEmail" name="owner_email">
            {% for data in agency_data %}
              <option value="{{ data.email }}">{{ data.name}}</option>
            {% endfor %}
          </select>
          <input id="rerouteReason" class="input-block-level" type="text" name="owner_reason" placeholder="Say why." required />
          <button id="rerouteButton" class="btn input-block-level" type="submit"> <i class="icon-envelope"> </i> Change point of contact</button>
      </fieldset>
    </form>

   <div><h4 class="participantRow-title" style="color: #333333;">Assignee</h4></div>

    <form id="rerouteForm" class="form-inline" method ="post" action="/update_a_owner">
      <fieldset>
        <!-- <label>Change Assignee</label> -->
          <input type="hidden" name="request_id" value="{{ req.id }}"/>
          <!--input id="rerouteEmail" class="input-block-level" type="email" name="owner_email" placeholder="name@email.com" data-provide="typeahead" autocomplete="off" required /-->
          <select class="span10" id="rerouteEmail" name="owner_email">
            {% for user in users %}
              {{ user.email }}
              <option value="{{ user.email }}">{{ user.alias}}</option>
            {% endfor %}
          </select>
          <input id="rerouteReason" class="input-block-level" type="text" name="owner_reason" placeholder="Say why." required />
          <button id="rerouteButtonAssignee" class="btn input-block-level" type="submit"> <i class="icon-envelope"> </i> Change Assignee</button>
      </fieldset>
    </form>

    <div class="row-fluid participantRow">
      <div class="participantRow-helpers"><h4 class="participantRow-title">Helpers</h4></div>
    </div>
    <div class="row-fluid participantRow-participants">
      {% for owner in req.owners %}
        {% if owner.active %}
          {% set participant = (owner | display_staff_participant(req)) %}
          {% if participant %}
            {% if current_user.is_authenticated %}

                <div>
                  {{ participant }}
                  <form id="unassignForm" class="form-inline" method ="post" action="/update_a_owner">
                        <input type="hidden" name="request_id" value="{{ req.id }}"/>
                        <input type="hidden" name="owner_id" value="{{ owner.id }}"/>
                        <input type="text" class="span8" name="reason_unassigned" value="Task complete" required />
                        <button id="unassignButton" class="btn btn-mini" type="submit"> <i class="icon-envelope"> </i> Remove</button>
                  </form>
                </div>

            {% else %}
              <div>
                {{ participant }}
              </div>
            {% endif %}
          {% endif %}
        {% endif %}
      {% endfor %}
    </div>

    <form id="notifyForm" class="form-inline" method ="post" action="/add_a_owner">
      <fieldset>
        <input type="hidden" name="request_id" value="{{ req.id }}"/>
        <input id="notifyEmail" class="input-block-level" type="email" name="owner_email" placeholder="name@email.com" data-provide="typeahead" autocomplete="off" required />
        <input id="notifyReason" class="input-block-level" type="text" name="owner_reason" placeholder="Say why." required />
        <button id="notifyButton" class="btn input-block-level" type="submit"> <i class="icon-envelope"> </i> Add a helper</button>
    </form>

    <div class="row-fluid participantRow-history">
      {% include '_history.html' %}
    </div>






  </div>

{% include '_manage_request_sidebar.html' %}
{% endblock sidebar %}

{% block request_dates %}
{{super()}}
<div class="text-center">Due: <span class="label">{{ req.due_date | date }}</span></div>
{% endblock request_dates %}


{% block follow %}{% endblock follow %}


{% block custom_script_links %}
<script type="text/javascript" src="{{ url_for('static', filename='js/case.js') }}"></script>

<!-- used for the extension and close request multi-select boxes in city view -->
<script type="text/javascript" src="{{ url_for('static', filename='js/plugins/bootstrap-select.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/custom.bootstrap-select.js') }}"></script>


<!-- For file uploads -->
<script type="text/javascript" src="{{ url_for('static', filename='js/plugins/bootstrap-fileupload.js') }}"></script>
{% endblock custom_script_links %}
